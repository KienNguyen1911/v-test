<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draw Blocks and Calculate Water</title>
    <style>
        #container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>

<input type="text" id="input" placeholder="Enter numbers separated by commas">
<button onclick="drawBlocks()">Draw Blocks</button>
<br>
<code>
    Gap between blocks: 10px
    <br>
    Gap between columns: 10px
    <br>
    Water color: #00a2e8
    <br>

</code>

<div id="container">
    <canvas id="canvas" width="700" height="400"></canvas>
</div>

<script>
    function drawBlocks() {
        const input = document.getElementById('input').value;
        const numbers = input.split(',').map(Number);
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const blockWidth = 40;
        const blockHeight = 20;
        const blockGap = 10;

        // Draw grid
        ctx.strokeStyle = '#e7e9eb';
        for (let x = 0; x <= canvas.width; x += 10) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
        }
        for (let y = 0; y <= canvas.height; y += 10) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
        }

        // Draw column by length of numbers
        for (let i = 0; i < numbers.length; i++) {
            // Draw block by value of numbers[i]
            for (let j = 0; j < numbers[i]; j++) {
                ctx.strokeStyle = 'black';

                // Adjust x position to include horizontal gap
                let xPos = i * (blockWidth + blockGap);
                // Adjust y position to include vertical gap, except for the first block
                let yPos = canvas.height - (j + 1) * (blockHeight + blockGap) + blockGap;
                if (j === 0) {
                    yPos = canvas.height - (j + 1) * blockHeight;
                }

                ctx.strokeRect(
                    xPos,       // x axis
                    yPos,       // y axis, adjusted for vertical gap
                    blockWidth, // width
                    blockHeight // height
                );
            }
        }

        // Calculate water
        let water = 0;
        let waterSquare = 0;
        let leftMax = new Array(numbers.length).fill(0);
        let rightMax = new Array(numbers.length).fill(0);

        leftMax[0] = numbers[0];
        for (let i = 1; i < numbers.length; i++) {
            leftMax[i] = Math.max(leftMax[i - 1], numbers[i]);
        }

        rightMax[numbers.length - 1] = numbers[numbers.length - 1];
        for (let i = numbers.length - 2; i >= 0; i--) {
            rightMax[i] = Math.max(rightMax[i + 1], numbers[i]);
        }

        for (let i = 0; i < numbers.length; i++) {
            water += Math.min(leftMax[i], rightMax[i]) - numbers[i];
        }

        // Draw water
        for (let i = 0; i < numbers.length; i++) {
            const height = numbers[i] * (blockHeight + blockGap);
            const waterHeight = (Math.min(leftMax[i], rightMax[i]) - numbers[i]) * (blockHeight + blockGap) - blockGap;
            let widthWater = blockWidth
            let xPos = i * (blockWidth + blockGap);

            // Adjust x position to include horizontal gap, if the block is higher than the previous block
            if (numbers[i] > numbers[i-1]) {
                xPos = xPos - blockGap
                widthWater = blockWidth + blockGap
            }
            
            // Adjust width of water block, if the block is higher than the next block
            if (numbers[i] > numbers[i+1]) {
                widthWater = blockWidth + blockGap
            }

            // Adjust width of water block, if the block is higher than the previous and next block
            if (numbers[i] > numbers[i-1] && numbers[i] > numbers[i+1]) {
                widthWater += blockGap
            }
            if (waterHeight > 0) {
                ctx.fillStyle = '#00a2e8';
                ctx.fillRect(
                    xPos,
                    canvas.height - height - waterHeight,
                    widthWater,
                    waterHeight
                );
            }
            waterSquare += waterHeight * widthWater;
            console.log('ok', waterSquare, waterHeight, widthWater)
        }

        alert(`Maximum water that can be trapped: ${waterSquare} cubic units`);
    }
</script>

</body>
</html>
